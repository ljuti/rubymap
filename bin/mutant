#!/usr/bin/env ruby
# frozen_string_literal: true

require "bundler/setup"
require "yaml"

# Load configuration from config/mutant.yml
config_path = File.expand_path("../config/mutant.yml", __dir__)
config = YAML.load_file(config_path)

# Build mutant arguments from configuration
args = ["bundle", "exec", "mutant", "run"]

# Add usage type
args.push("--usage", config["usage"])

# Add integration settings
if config["integration"]
  args.push("--integration", config["integration"]["name"])
  
  # Add integration arguments if specified
  if config["integration"]["arguments"]
    config["integration"]["arguments"].each do |arg|
      args.push("--integration-argument", arg)
    end
  end
end

# Add subjects from command line or default to all Rubymap classes
subjects = ARGV.empty? ? ["Rubymap*"] : ARGV
args.concat(subjects)

# Run mutant with configuration
system(*args)